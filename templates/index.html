<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Generador de Carteles</title>
    <style>
        /* Declaramos la fuente */
        @font-face { font-family: 'MiFuentePersonalizada'; src: url('/static/ARIBLK.TTF'); }
        
        body { 
            font-family: sans-serif; 
            margin: 0;
            /* --- ¡FONDO REINCORPORADO! --- */
            background-image: url('/static/background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        .app-container { 
            display: flex; 
            gap: 40px; 
            align-items: flex-start; 
            padding: 20px; 
            /* Añadimos esto para centrar el contenedor principal */
            width: 100%;
            min-height: 100vh;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
        }
        .form-box { 
            background: rgba(255, 255, 255, 0.9); 
            padding: 2rem; 
            border-radius: 8px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); 
            text-align: center; 
            width: 400px; 
        }
        .preview-box { background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { margin-top: 0; color: #333; }
        textarea { font-size: 1rem; padding: 10px; width: 95%; height: 120px; border: 1px solid #ccc; border-radius: 4px; font-family: sans-serif; resize: vertical; margin-bottom: 1rem; }
        .actions-container { display: flex; justify-content: center; gap: 10px; margin-bottom: 1rem; }
        button, .gallery-button { font-size: 1rem; padding: 10px 20px; color: white; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; }
        #saveButton { background-color: #17a2b8; }
        #printButton { background-color: #007bff; }
        .gallery-button { background-color: #28a745; }
        #previewCanvas { width: 600px; height: auto; border: 1px solid #ccc; }
        #printFrame { display: none; }

        /* --- ¡LOGO REINCORPORADO! --- */
        .logo-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .logo-container img {
            max-width: 150px;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="form-box">
            <h1>Generador de Carteles</h1>
            <form id="generatorForm" action="/generar" method="POST">
                <label for="texto_cartel">Escribe tu texto:</label><br><br>
                <textarea id="texto_cartel" name="texto" required></textarea>
                <input type="hidden" id="actionInput" name="accion" value="">
                <div class="actions-container">
                    <button type="submit" id="saveButton" onclick="setAction('guardar')">Guardar PDF</button>
                    <button type="button" id="printButton">Imprimir</button>
                </div>
            </form>
            <a href="/galeria" class="gallery-button">Ver Galería de Carteles</a>
        </div>
        <div class="preview-box">
            <h2>Previsualización en Vivo</h2>
            <canvas id="previewCanvas"></canvas>
        </div>
    </div>

    <!-- Contenedor del Logo -->
    <div class="logo-container">
        <img src="/static/logo.jpg" alt="Logo CEVA Logistics">
    </div>

    <script>
        // (El código JavaScript no necesita ningún cambio)
        const FONT_SIZE = 250; const FONT_NAME = 'MiFuentePersonalizada'; const LINE_SPACING = 30; const TEXT_COLOR = 'black';
        const textArea = document.getElementById('texto_cartel'); const canvas = document.getElementById('previewCanvas'); const ctx = canvas.getContext('2d');
        const plantillaImage = new Image(); plantillaImage.src = '/static/plantilla.png';
        plantillaImage.onload = function() { canvas.width = plantillaImage.width; canvas.height = plantillaImage.height; drawPreview(); };
        textArea.addEventListener('input', drawPreview);
        function drawPreview() { const text = textArea.value.toUpperCase(); ctx.drawImage(plantillaImage, 0, 0); ctx.fillStyle = TEXT_COLOR; ctx.font = `${FONT_SIZE}px ${FONT_NAME}`; ctx.textAlign = 'center'; const lines = text.split('\n'); const totalTextHeight = (lines.length * FONT_SIZE) + ((lines.length - 1) * LINE_SPACING); let startY = (canvas.height - totalTextHeight) / 2 + (FONT_SIZE / 2); for (let i = 0; i < lines.length; i++) { const line = lines[i]; const y = startY + (i * (FONT_SIZE + LINE_SPACING)); ctx.fillText(line, canvas.width / 2, y); } }

        const form = document.getElementById('generatorForm');
        const actionInput = document.getElementById('actionInput');
        const printButton = document.getElementById('printButton');
        const printFrame = document.getElementById('printFrame');

        function setAction(action) {
            actionInput.value = action;
        }

        printButton.addEventListener('click', function() {
            setAction('imprimir');
            const formData = new FormData(form);
            fetch('/generar', {
                method: 'POST',
                body: formData
            })
            .then(response => response.blob())
            .then(blob => {
                const pdfUrl = URL.createObjectURL(blob);
                printFrame.src = pdfUrl;
                printFrame.onload = function() {
                    try {
                        printFrame.contentWindow.print();
                    } catch (e) {
                        console.error("Error de impresión:", e);
                    }
                };
            });
        });
    </script>
</body>
</html>